ê°‘ìê¸° ì—¬ìì¹œêµ¬ê°€ ê¸°ë¶„ì´ ë‚˜ì˜ë‹¤ê³  í–ˆë‹¤.... ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? 
# OUTBRAIN
OUTBRAINì€ ì¼ê¸°ë¥¼ ë‹¨ìˆœíˆ ì €ì¥í•˜ì§€ ì•Šê³ , ê¸°ë¡ì„ ë²¡í„°ì™€ ê·¸ë˜í”„ë¡œ êµ¬ì¡°í™”í•˜ì—¬ ê°œì¸ì˜ ê¸°ì–µê³¼ ê²½í—˜ì„ ë¶„ì„í•˜ëŠ” ì¸ì‚¬ì´íŠ¸ ë‹¤ì´ì–´ë¦¬ì…ë‹ˆë‹¤. 

ì‚¬ìš©ìëŠ” ì¼ê¸°ë¥¼ ì“°ëŠ” ê²ƒë§Œìœ¼ë¡œ ê³¼ê±°ì˜ ê°ì •, ì‚¬ëŒ, ì‚¬ê±´ì´ ì–´ë–»ê²Œ ë°˜ë³µÂ·ì—°ê²°ë˜ëŠ”ì§€ë¥¼ ê·¸ë˜í”„ ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

### í•µì‹¬ ê°€ì¹˜

- **ì˜ë¯¸ ê²€ìƒ‰ (Vector Memory)**: ë¹„ìŠ·í•œ ê°ì •, ê²½í—˜ì„ ì˜ë¯¸ì ìœ¼ë¡œ ì—°ê²°
- **ê´€ê³„ ë©”ëª¨ë¦¬ (Graph Memory)**: ì‚¬ëŒ, ì‚¬ê±´, ê°ì •ì˜ ì¸ê³¼ê´€ê³„ë¥¼ êµ¬ì¡°í™”
- **AI ì¶”ë¡  ì—”ì§„**: ê³¼ê±° íŒ¨í„´ì„ ê¸°ë°˜ìœ¼ë¡œ í†µì°°ë ¥ ìˆëŠ” ë‹µë³€ ì œê³µ
- **ì‹œê°í™”**: ê¸°ì–µì„ ê·¸ë˜í”„ë¡œ ì‹œê°í™”í•˜ì—¬ ì§ê´€ì  ì´í•´

---

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Frontend (React + Vite)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Pages: Search, Write, Read, Insight      â”‚   â”‚
â”‚  â”‚ Context: DiariesContext (Global State)   â”‚   â”‚
â”‚  â”‚ API Client: diaries.ts, question.ts      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Backend (FastAPI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API Layer:                               â”‚   â”‚
â”‚  â”‚  - /api/v1/records (CRUD)                â”‚   â”‚
â”‚  â”‚  - /api/v1/question (RAG)                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Service Layer:                           â”‚   â”‚
â”‚  â”‚  - IngestionService (ë°ì´í„° íŒŒì´í”„ë¼ì¸)  â”‚   â”‚
â”‚  â”‚  - ReasoningService (RAG ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜) â”‚   â”‚
â”‚  â”‚  - RecordService (CRUD)                  â”‚   â”‚
â”‚  â”‚  - LLMService (OpenAI/NVIDIA í†µí•©)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                       â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚  MongoDB    â”‚   â”‚  Neo4j Graph   â”‚   â”‚ OpenAI   â”‚
â”‚  (Atlas)    â”‚   â”‚                â”‚   â”‚          â”‚
â”‚             â”‚   â”‚                â”‚   â”‚          â”‚
â”‚ - Records   â”‚   â”‚ - Knowledge    â”‚   â”‚ - LLM    â”‚
â”‚ - Vector    â”‚   â”‚   Graph        â”‚   â”‚ - Embed  â”‚
â”‚   Search    â”‚   â”‚ - Subgraph     â”‚   â”‚ - Rerank â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° ë ˆì´ì–´ ì•„í‚¤í…ì²˜

```
[ì¼ê¸° ì‘ì„±]
  â†“
[Ingestion Service]
  â”œâ”€ 1. í…ìŠ¤íŠ¸ ì„ë² ë”© (OpenAI)
  â”œâ”€ 2. MongoDB ì €ì¥ (embedding í¬í•¨)
  â””â”€ 3. Neo4j ê·¸ë˜í”„ ìƒì„± (Entity Extraction)

[ì§ˆë¬¸ ì²˜ë¦¬ - RAG Pipeline]
  â†“
[Reasoning Service]
  â”œâ”€ 1. ì§ˆë¬¸ ì„ë² ë”©
  â”œâ”€ 2. Hybrid Search (Vector + Text + Time Decay)
  â”œâ”€ 3. LLM Reranking (ê´€ë ¨ì„± ì¬í‰ê°€)
  â”œâ”€ 4. Graph Retrieval (ì»¨í…ìŠ¤íŠ¸ ì„œë¸Œê·¸ë˜í”„)
  â””â”€ 5. Answer Generation (LLM ì¶”ë¡ )
```

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Backend
| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ìš©ë„ |
|---------|------|------|
| Framework | FastAPI | ë¹„ë™ê¸° REST API |
| Document DB | MongoDB Atlas | ì¼ê¸° ì €ì¥ + Vector Search |
| Graph DB | Neo4j | ê´€ê³„ ë©”ëª¨ë¦¬, ì—”í‹°í‹° ê·¸ë˜í”„ |
| LLM Provider | OpenAI   | ì„ë² ë”©, ë‹µë³€ ìƒì„±, Reranking |
| Async DB Driver | Motor (MongoDB), AsyncGraphDatabase (Neo4j) | ë¹„ë™ê¸° ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° |
| Validation | Pydantic | ë°ì´í„° ê²€ì¦ ë° ì„¤ì • ê´€ë¦¬ |

### Frontend
| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ìš©ë„ |
|---------|------|------|
| Framework | React 18.2 + TypeScript | UI êµ¬ì¶• |
| Build Tool | Vite 5.0 | ê°œë°œ í™˜ê²½ |
| Routing | React Router 6.21 | SPA ë¼ìš°íŒ… |
| Styling | TailwindCSS 3.3 | ìœ í‹¸ë¦¬í‹° ê¸°ë°˜ ìŠ¤íƒ€ì¼ë§ |
| Rich Editor | Lexical 0.39 | ì¼ê¸° ì‘ì„± ì—ë””í„° |
| Graph Viz | ReactFlow 11.10, D3.js 7.8 | ê·¸ë˜í”„ ì‹œê°í™” |
| State | Context API | ì „ì—­ ìƒíƒœ ê´€ë¦¬ |

### AI/ML
- **Embedding Model**: OpenAI `text-embedding-3-small` (1536ì°¨ì›)
- **Chat Model**: OpenAI `gpt-4o` 
- **Reranking**: LLM ê¸°ë°˜ ê´€ë ¨ì„± ì ìˆ˜ ê³„ì‚° (0.0~1.0)

---

## ğŸš€ í•µì‹¬ ê¸°ëŠ¥

### 1. ê°œì¸ ê¸°ë¡ ì…ë ¥/ìƒì„± íŒŒì´í”„ë¼ì¸

**ììœ  í…ìŠ¤íŠ¸ â†’ êµ¬ì¡°í™”ëœ ë©”ëª¨ë¦¬**

- ììœ  í…ìŠ¤íŠ¸ ì¼ê¸°ë¥¼ í‘œì¤€ Recordë¡œ ì €ì¥
- UUID ê¸°ë°˜ `recordId`ë¡œ MongoDBì™€ Neo4j ì—°ê²°
- ìˆ˜ì •/ì‚­ì œ(soft delete) ë¼ì´í”„ì‚¬ì´í´ ì§€ì›
- ìë™ ì„ë² ë”© ìƒì„± (1536ì°¨ì› ë²¡í„°)
- LLM ê¸°ë°˜ ì—”í‹°í‹° ìë™ ì¶”ì¶œ (Event, Person, Emotion, Action, Outcome)

**Record ìŠ¤í‚¤ë§ˆ**
```json
{
  "recordId": "UUID",
  "userId": "string",
  "title": "string",
  "content": "string",
  "feel": ["ê¸°ì¨", "ìŠ¬í””"],
  "date": "YYYY-MM-DD",
  "createdAt": "datetime",
  "updatedAt": "datetime?",
  "deletedAt": "datetime?",
  "embedding": [1536ì°¨ì› float ë°°ì—´]
}
```

---

### 2. ì˜ë¯¸ ë©”ëª¨ë¦¬ (Vector Memory)

**MongoDB Atlas Vector Search ê¸°ë°˜**

- **ëª©ì **: "ë¹„ìŠ·í•œ ê¸°ë¡"ì„ ì˜ë¯¸ì ìœ¼ë¡œ ë¹ ë¥´ê²Œ ê²€ìƒ‰
- **êµ¬ì„±**:
  - í…ìŠ¤íŠ¸(title + content) â†’ OpenAI Embedding â†’ VectorDB ì €ì¥
  - Vector Index + Text Index (BM25-like)
- **ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜**:
  - **Hybrid Search**: Vector Search + Text Search
  - **RRF Fusion**: Reciprocal Rank Fusion (k=60)
  - **Time Decay**: ìµœì‹  ê¸°ë¡ ìš°ì„  (30ì¼ ë°˜ê°ê¸°, weight=0.3)
  - **ê²°ê³¼**: ì˜ë¯¸ ìœ ì‚¬ë„ + ì‹œê°„ ê°€ì¤‘ì¹˜ë¥¼ ê²°í•©í•œ ìµœì¢… ì ìˆ˜

**ê²€ìƒ‰ ê³µì‹**
```python
RRF Score = weight * (1 / (k + rank))
Time Decay = 2^(-days_ago / 30)
Final Score = (1 - 0.3) * RRF + 0.3 * Time_Decay
```

---

### 3. ê´€ê³„ ë©”ëª¨ë¦¬ (Graph Memory)

**Neo4j ê¸°ë°˜ Knowledge Graph**

- **ëª©ì **: ê¸°ë¡ì„ êµ¬ì¡°í™”í•˜ì—¬ íŒ¨í„´Â·ê´€ê³„Â·ì¸ê³¼ë¥¼ ëˆ„ì 
- **ë…¸ë“œ íƒ€ì…**: User, Record, Event, Person, Emotion, Action, Outcome
- **ê´€ê³„ íƒ€ì…**: OWNS, HAS_EVENT, HAS_EMOTION, INVOLVES, HAS_ACTION, LEADS_TO
- **ì„¤ëª…ê°€ëŠ¥ì„±**: ëª¨ë“  ê´€ê³„ëŠ” `evidenceRecordId`(UUID) ë³´ìœ 
- **ì¸ë±ìŠ¤**: userId + recordId ë³µí•© ì¸ë±ìŠ¤ë¡œ ë¹ ë¥¸ ì¡°íšŒ

**ê·¸ë˜í”„ ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ**
```cypher
(:User {userId})
  -[:OWNS]->
(:Record {recordId, date, userId})
  -[:HAS_EVENT]-> (:Event {summary})
    -[:INVOLVES]-> (:Person {name})
    -[:HAS_ACTION]-> (:Action {description})
      -[:LEADS_TO]-> (:Outcome {description})
  -[:HAS_EMOTION]-> (:Emotion {label})
```

---

### 4. RAG ê¸°ë°˜ ì§ˆë¬¸ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

**6ë‹¨ê³„ ì¶”ë¡  ì—”ì§„**

1. **ì§ˆë¬¸ ì„ë² ë”©**: ìì—°ì–´ ì§ˆë¬¸ â†’ ë²¡í„° ë³€í™˜
2. **Hybrid Search**: Vector + Text ê²€ìƒ‰, Time Decay ì ìš© (ìƒìœ„ 10ê°œ)
3. **LLM Reranking**: ê´€ë ¨ì„± ì¬í‰ê°€ (0.0~1.0 ì ìˆ˜) â†’ ìƒìœ„ 5ê°œ ì„ íƒ
4. **Graph Retrieval**: ì„ íƒëœ recordIdë¡œ Neo4j ì„œë¸Œê·¸ë˜í”„ ì¡°íšŒ (1-hop, ìµœëŒ€ 50ê°œ ê²½ë¡œ)
5. **LLM Reasoning**: ì»¨í…ìŠ¤íŠ¸(Vector + Graph) ê¸°ë°˜ ë‹µë³€ ìƒì„±
6. **ì‘ë‹µ êµ¬ì„±**: answer + confidence + reasoningPath (ì°¸ì¡° ì¼ê¸°, ê·¸ë˜í”„ í†µê³„)

**ì˜ˆì‹œ ì§ˆë¬¸-ë‹µë³€**
```
Q: "í‡´ì‚¬ë¥¼ ê³ ë¯¼í•œ ì ì€?"
A: "ìŒ, ì‘ë…„ 11ì›”ì— í‡´ì‚¬ë¥¼ ê³ ë¯¼í–ˆë˜ ê²ƒ ê°™ì•„.
    ê·¸ë•Œ íšŒì‚¬ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹¬í–ˆê³ , ìƒˆë¡œìš´ ê¸°íšŒë¥¼ ì°¾ê³  ìˆì—ˆì–´."
Confidence: 0.85
Reasoning: 2024-11-15 ì¼ê¸° ì°¸ì¡° (íšŒì‚¬ ìŠ¤íŠ¸ë ˆìŠ¤, ì´ì§ ê³ ë¯¼ ì–¸ê¸‰)
```

--- 

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### ì¼ê¸° ì‘ì„± í”Œë¡œìš°

```
[Frontend WritePage]
  â”œâ”€ ì…ë ¥: title, content, feel, date, userId
  â””â”€ POST /api/v1/records
        â†“
[Backend IngestionService]
  â”œâ”€ 1. í…ìŠ¤íŠ¸ ê²°í•© (title + content)
  â”œâ”€ 2. LLM.get_embedding() â†’ 1536ì°¨ì› ë²¡í„°
  â”œâ”€ 3. UUID recordId ìƒì„±
  â”œâ”€ 4. MongoDB ì €ì¥ (embedding í¬í•¨)
  â”œâ”€ 5. LLM.generate_graph_cypher() â†’ Cypher ì¿¼ë¦¬
  â””â”€ 6. Neo4j ì €ì¥
        - User ë…¸ë“œ (MERGE)
        - Record ë…¸ë“œ (CREATE)
        - Event/Person/Emotion/Action/Outcome ë…¸ë“œ
        - ê´€ê³„ ìƒì„± (ëª¨ë‘ evidenceRecordId í¬í•¨)
        â†“
[Response]
  â””â”€ { recordId: "UUID" }
```

### ì§ˆë¬¸ ì²˜ë¦¬ í”Œë¡œìš° (RAG)

```
[Frontend SearchPage]
  â”œâ”€ ì…ë ¥: "í‡´ì‚¬ë¥¼ ê³ ë¯¼í•œ ì ì€?"
  â””â”€ POST /api/v1/question
        â†“
[Backend ReasoningService]
  â”œâ”€ 1. [Embedding]
  â”‚    LLM.get_embedding(question) â†’ query_vector
  â”‚
  â”œâ”€ 2. [Hybrid Search]
  â”‚    VectorDB.search(query_vector, query_text)
  â”‚      â”œâ”€ Vector Search (cosine similarity)
  â”‚      â”œâ”€ Text Search (BM25-like keyword)
  â”‚      â”œâ”€ RRF Fusion (weight=0.5 each)
  â”‚      â”œâ”€ Time Decay (weight=0.3, 30-day half-life)
  â”‚      â””â”€ Top 10 candidates
  â”‚
  â”œâ”€ 3. [Reranking]
  â”‚    LLM.rerank(query, documents, top_k=5)
  â”‚      â””â”€ ê° ë¬¸ì„œì˜ ê´€ë ¨ì„± ì ìˆ˜ (0.0~1.0)
  â”‚
  â”œâ”€ 4. [Graph Retrieval]
  â”‚    Neo4j.get_context_subgraph(user_id, record_ids, hop=1)
  â”‚      â”œâ”€ recordId ê¸°ë°˜ ì¡°íšŒ
  â”‚      â”œâ”€ 1-hop ì´ì›ƒ íƒìƒ‰ (User ì œì™¸)
  â”‚      â””â”€ ìµœëŒ€ 50ê°œ ê²½ë¡œ
  â”‚
  â”œâ”€ 5. [LLM Reasoning]
  â”‚    LLM.generate_answer_with_reasoning(
  â”‚      question,
  â”‚      context_records,    # Vector ê²€ìƒ‰ ê²°ê³¼
  â”‚      context_graph       # Neo4j ì„œë¸Œê·¸ë˜í”„
  â”‚    )
  â”‚      â”œâ”€ í•œêµ­ì–´ ë°˜ë§ í†¤
  â”‚      â”œâ”€ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì¶”ë¡ 
  â”‚      â””â”€ confidence ì ìˆ˜ ê³„ì‚°
  â”‚
  â””â”€ 6. [Response]
       {
         "answer": "ìŒ, ì‘ë…„ 11ì›”ì—...",
         "confidence": 0.85,
         "reasoningPath": {
           "summary": "2024-11-15 ì¼ê¸° ì°¸ì¡°...",
           "records": ["mongo_id_1", "mongo_id_2"],
           "graph_snapshot": {
             "node_count": 15,
             "edge_count": 20
           }
         }
       }
```

---

## ğŸ’» ì„¤ì¹˜ ë° ì‹¤í–‰

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Python 3.10+
- Node.js 18+
- MongoDB Atlas ê³„ì • (Vector Search ì§€ì›)
- Neo4j ë°ì´í„°ë² ì´ìŠ¤ (ë¡œì»¬ ë˜ëŠ” Aura)
- OpenAI API Key ë˜ëŠ” NVIDIA NeMo API Key

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`backend/.env` íŒŒì¼ ìƒì„±:
```env
# MongoDB (Atlas)
MONGODB_URI=mongodb+srv://<user>:<password>@cluster.mongodb.net/?retryWrites=true&w=majority
DATABASE_NAME=outbrain
COLLECTION_NAME=diaries

# Neo4j
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your_password

# LLM Provider  
LLM_PROVIDER=openai

# OpenAI
OPENAI_API_KEY=sk-...
OPENAI_MODEL_NAME=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# NVIDIA NeMo (ì„ íƒì )
NVIDIA_API_KEY=nvapi-...
```

### MongoDB Atlas Vector Search ì¸ë±ìŠ¤ ìƒì„±

MongoDB Atlas Consoleì—ì„œ `diaries` ì»¬ë ‰ì…˜ì— ì¸ë±ìŠ¤ ìƒì„±:

**Vector Index (vector_index)**
```json
{
  "fields": [
    {
      "type": "vector",
      "path": "embedding",
      "numDimensions": 1536,
      "similarity": "cosine"
    }
  ]
}
```

**Text Index (text_index)**
```json
{
  "mappings": {
    "dynamic": false,
    "fields": {
      "title": { "type": "string" },
      "content": { "type": "string" }
    }
  }
}
```

### Neo4j ì¸ë±ìŠ¤ ìƒì„±

Neo4j ë¸Œë¼ìš°ì € ë˜ëŠ” Cypher Shellì—ì„œ ì‹¤í–‰:
```cypher
CREATE INDEX user_record_idx IF NOT EXISTS
FOR (r:Record)
ON (r.userId, r.recordId);

CREATE INDEX user_entity_idx IF NOT EXISTS
FOR (e:Event)
ON (e.userId);

CREATE INDEX user_idx IF NOT EXISTS
FOR (u:User)
ON (u.userId);
```

### ë°±ì—”ë“œ ì‹¤í–‰ (FastAPI)

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

- API ì„œë²„: http://localhost:8000
- API ë¬¸ì„œ (Swagger): http://localhost:8000/docs
- API ë¬¸ì„œ (ReDoc): http://localhost:8000/redoc

---

### í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ (Vite)

```bash
cd frontend
npm install
npm run dev
```

- í”„ë¡ íŠ¸ì—”ë“œ: http://localhost:5173
- API ìš”ì²­ì€ `/api` ê²½ë¡œë¥¼ í†µí•´ `http://localhost:8000`ìœ¼ë¡œ ìë™ í”„ë¡ì‹œ

---

### í”„ë¡œë•ì…˜ ë¹Œë“œ

```bash
# í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
cd frontend
npm run build

# ë°±ì—”ë“œê°€ frontend/distë¥¼ ìë™ìœ¼ë¡œ ì„œë¹™
cd ../backend
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

--- 

### Records API

#### 1. ì¼ê¸° ëª©ë¡ ì¡°íšŒ
```http
GET /records
Query Parameters:
  - user_id (optional): íŠ¹ì • ì‚¬ìš©ì í•„í„°ë§

Response: 200 OK
[
  {
    "_id": "mongo_object_id",
    "recordId": "uuid",
    "userId": "user123",
    "title": "ì˜¤ëŠ˜ì˜ ì¼ê¸°",
    "content": "ì˜¤ëŠ˜ì€...",
    "feel": ["ê¸°ì¨"],
    "date": "2024-11-15",
    "createdAt": "2024-11-15T10:00:00Z",
    "updatedAt": null,
    "deletedAt": null
  }
]
```

#### 2. ì¼ê¸° ìƒì„¸ ì¡°íšŒ
```http
GET /records/{record_id}

Response: 200 OK
{
  "_id": "mongo_object_id",
  "recordId": "uuid",
  ...
}

Error: 404 Not Found
{
  "detail": "Record not found"
}
```

#### 3. ì¼ê¸° ìƒì„±
```http
POST /records
Content-Type: application/json

Request Body:
{
  "userId": "user123",
  "title": "ì˜¤ëŠ˜ì˜ ì¼ê¸°",
  "content": "ì˜¤ëŠ˜ì€ ì •ë§ ì¢‹ì€ ì¼ì´ ìˆì—ˆë‹¤. ì¹œêµ¬ë¥¼ ë§Œë‚˜ì„œ...",
  "feel": ["ê¸°ì¨", "í‰ì˜¨"],
  "date": "2024-11-15"
}

Response: 201 Created
{
  "recordId": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Record created successfully"
}
```

#### 4. ì¼ê¸° ìˆ˜ì •
```http
PUT /records/{record_id}
Content-Type: application/json

Request Body:
{
  "title": "ìˆ˜ì •ëœ ì œëª©",
  "content": "ìˆ˜ì •ëœ ë‚´ìš©",
  "feel": ["í‰ì˜¨"],
  "date": "2024-11-15"
}

Response: 200 OK
{
  "_id": "mongo_object_id",
  "recordId": "uuid",
  "updatedAt": "2024-11-15T11:00:00Z",
  ...
}
```

#### 5. ì¼ê¸° ì‚­ì œ (Soft Delete)
```http
DELETE /records/{record_id}

Response: 204 No Content
```

---

### Question API (RAG)

#### ì§ˆë¬¸ ì²˜ë¦¬
```http
POST /question
Content-Type: application/json

Request Body:
{
  "userId": "user123",
  "text": "í‡´ì‚¬ë¥¼ ê³ ë¯¼í•œ ì ì€?",
  "searchSessionId": null  // optional
}

Response: 200 OK
{
  "answer": "ìŒ, ì‘ë…„ 11ì›”ì— í‡´ì‚¬ë¥¼ ê³ ë¯¼í–ˆë˜ ê²ƒ ê°™ì•„. ê·¸ë•Œ íšŒì‚¬ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹¬í–ˆê³ ...",
  "confidence": 0.85,
  "reasoningPath": {
    "summary": "2024-11-15 ì¼ê¸°ì™€ 2024-11-20 ì¼ê¸°ë¥¼ ì°¸ì¡°í–ˆì–´ìš”.",
    "records": [
      "673abc123def456...",
      "673def789ghi012..."
    ],
    "graph_snapshot": {
      "node_count": 15,
      "edge_count": 22
    }
  }
}

Error: 400 Bad Request
{
  "detail": "Question text is required"
}
```

---

## ğŸ—„ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### MongoDB Document Schema

**ì»¬ë ‰ì…˜**: `outbrain.diaries`

```javascript
{
  _id: ObjectId,               // MongoDB ê¸°ë³¸ í‚¤ (í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œìš©)
  recordId: String (UUID),     // ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ê³ ìœ  ID (Neo4j ì—°ê²°ìš©)
  userId: String,              // ì‚¬ìš©ì ì‹ë³„ì
  title: String,               // ì¼ê¸° ì œëª©
  content: String,             // ì¼ê¸° ë³¸ë¬¸
  feel: [String],              // ê°ì • íƒœê·¸ ë°°ì—´ ["ê¸°ì¨", "ìŠ¬í””", ...]
  date: String (YYYY-MM-DD),   // ì¼ê¸° ë‚ ì§œ
  createdAt: ISODate,          // ìƒì„± ì‹œê°
  updatedAt: ISODate | null,   // ìˆ˜ì • ì‹œê°
  deletedAt: ISODate | null,   // ì‚­ì œ ì‹œê° (soft delete)
  embedding: [Number]          // 1536ì°¨ì› ì„ë² ë”© ë²¡í„°
}
```

**ì¸ë±ìŠ¤**:
- `vector_index`: embedding í•„ë“œ ë²¡í„° ê²€ìƒ‰ (cosine similarity)
- `text_index`: title, content í•„ë“œ ì „ë¬¸ ê²€ìƒ‰ (BM25-like)
- `{ userId: 1, createdAt: -1 }`: ì‚¬ìš©ìë³„ ìµœì‹  ì¼ê¸° ì¡°íšŒ

---

### Neo4j Graph Schema

**ë…¸ë“œ íƒ€ì…**:

```cypher
// ì‚¬ìš©ì
(:User {
  userId: String,
  createdAt: DateTime
})

// ì¼ê¸° ë ˆì½”ë“œ
(:Record {
  recordId: String (UUID),     // MongoDB recordIdì™€ ë™ì¼
  userId: String,
  date: String,
  createdAt: DateTime
})

// ì´ë²¤íŠ¸
(:Event {
  id: String,
  summary: String,
  userId: String
})

// ì‚¬ëŒ
(:Person {
  name: String,
  userId: String
})

// ê°ì •
(:Emotion {
  label: String,               // "ê¸°ì¨", "ìŠ¬í””", "ë¶„ë…¸", ...
  userId: String
})

// í–‰ë™
(:Action {
  description: String,
  userId: String
})

// ê²°ê³¼
(:Outcome {
  description: String,
  userId: String
})
```

**ê´€ê³„ íƒ€ì…**:

```cypher
(:User)-[:OWNS]->(:Record)
(:Record)-[:HAS_EVENT]->(:Event)
(:Record)-[:HAS_EMOTION]->(:Emotion)
(:Event)-[:INVOLVES]->(:Person)
(:Event)-[:HAS_ACTION]->(:Action)
(:Action)-[:LEADS_TO]->(:Outcome)
```

**ì„¤ëª…ê°€ëŠ¥ì„± ë³´ì¥**:
- ëª¨ë“  ê´€ê³„ëŠ” `evidenceRecordId` ì†ì„± ë³´ìœ 
- ì¶”ë¡  ì‹œ ê·¼ê±° ì¶”ì  ê°€ëŠ¥

**ì˜ˆì‹œ ê·¸ë˜í”„**:
```cypher
(:User {userId: "user123"})
  -[:OWNS]->
(:Record {recordId: "uuid-1", date: "2024-11-15"})
  -[:HAS_EVENT]->
(:Event {summary: "íšŒì‚¬ ë¯¸íŒ…"})
  -[:INVOLVES]->
(:Person {name: "ê¹€ëŒ€ë¦¬"})

(:Record {recordId: "uuid-1"})
  -[:HAS_EMOTION]->
(:Emotion {label: "ìŠ¤íŠ¸ë ˆìŠ¤"})
```

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
log/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ api.py              # API ë¼ìš°í„° í†µí•©
â”‚   â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚   â”‚           â”œâ”€â”€ records.py      # ì¼ê¸° CRUD API
â”‚   â”‚   â”‚           â””â”€â”€ question.py     # ì§ˆë¬¸ ì²˜ë¦¬ API
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â””â”€â”€ config.py               # í™˜ê²½ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ mongo.py                # MongoDB ì—°ê²°
â”‚   â”‚   â”‚   â”œâ”€â”€ graph.py                # Neo4j ì—°ê²°
â”‚   â”‚   â”‚   â””â”€â”€ vector.py               # Vector Search ì¶”ìƒí™”
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ record.py           # Record ë„ë©”ì¸ ëª¨ë¸
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ graph.py            # Graph ë„ë©”ì¸ ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚   â”‚       â”œâ”€â”€ record_req.py       # Record ìš”ì²­ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”‚       â””â”€â”€ question_req.py     # Question ìš”ì²­ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_service.py          # LLM í†µí•© ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ ingestion_service.py    # ì¼ê¸° ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸
â”‚   â”‚   â”‚   â”œâ”€â”€ record_service.py       # Record CRUD
â”‚   â”‚   â”‚   â””â”€â”€ reasoning_service.py    # RAG ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”‚   â”‚   â””â”€â”€ main.py                     # FastAPI ì•± ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ tests/                          # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ diaries.ts              # Diaries API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ question.ts             # Question API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ DiaryEditor.tsx         # Lexical ì—ë””í„°
â”‚   â”‚   â”‚   â”œâ”€â”€ KeywordGraph.tsx        # ReactFlow ê·¸ë˜í”„
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchBar.tsx           # ê²€ìƒ‰ ì…ë ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ Timeline.tsx            # íƒ€ì„ë¼ì¸
â”‚   â”‚   â”‚   â”œâ”€â”€ GraphDetailPanel.tsx    # ê·¸ë˜í”„ ìƒì„¸ íŒ¨ë„
â”‚   â”‚   â”‚   â””â”€â”€ NodeDetailPanel.tsx     # ë…¸ë“œ ìƒì„¸ íŒ¨ë„
â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â””â”€â”€ DiariesContext.tsx      # ì „ì—­ ìƒíƒœ (Context API)
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useDiaries.ts           # ì»¤ìŠ¤í…€ í›…
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchPage.tsx          # ê²€ìƒ‰/ì§ˆë¬¸ í˜ì´ì§€
â”‚   â”‚   â”‚   â”œâ”€â”€ WritePage.tsx           # ì¼ê¸° ì‘ì„± í˜ì´ì§€
â”‚   â”‚   â”‚   â”œâ”€â”€ ReadPage.tsx            # ì¼ê¸° ëª©ë¡ í˜ì´ì§€
â”‚   â”‚   â”‚   â””â”€â”€ InsightPage.tsx         # ì¸ì‚¬ì´íŠ¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ App.tsx                     # ë¼ìš°íŒ…
â”‚   â”‚   â””â”€â”€ main.tsx                    # ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ tailwind.config.js
â”‚
â”œâ”€â”€ data/                               # ìƒ˜í”Œ ë°ì´í„°
â”œâ”€â”€ schema/                             # ìŠ¤í‚¤ë§ˆ ì •ì˜
â””â”€â”€ README.md
```

---
 

### ì„±ëŠ¥ (Performance)  
- **ì¸ë±ìŠ¤ ì „ëµ**:
  - `user_record_idx`: (userId, recordId) ë³µí•© ì¸ë±ìŠ¤
  - `user_entity_idx`: userId ë‹¨ì¼ ì¸ë±ìŠ¤
- **Hop ì œí•œ**: 1-2 hopìœ¼ë¡œ ì„œë¸Œê·¸ë˜í”„ í¬ê¸° ì œì–´
- **User ë…¸ë“œ ì œì™¸**: ìŠˆí¼ë…¸ë“œë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ë°©ì§€
- **ê²½ë¡œ ì œí•œ**: ìµœëŒ€ 50ê°œ ê²½ë¡œ ë°˜í™˜ 
---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
cd backend
pytest tests/ -v
```

### ì£¼ìš” í…ŒìŠ¤íŠ¸ íŒŒì¼
- `tests/api/test_question.py`: ì§ˆë¬¸ API í†µí•© í…ŒìŠ¤íŠ¸
- `tests/db/test_graph.py`: Neo4j ì—°ê²° ë° ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
- `tests/db/test_mongo.py`: MongoDB ì—°ê²° ë° CRUD í…ŒìŠ¤íŠ¸
- `tests/services/test_reasoning_service.py`: RAG íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
- `tests/services/test_llm_service.py`: LLM ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

ì£¼ìš” ì»¤ë²„ë¦¬ì§€ í•­ëª©:
- Hybrid Search (Vector + Text + RRF + Time Decay)
- LLM Reranking
- Graph Subgraph Retrieval
- RAG íŒŒì´í”„ë¼ì¸ (end-to-end) 
---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” ê°œì¸ ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. 
---

## ğŸ“§ ë¬¸ì˜

í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ ì œì•ˆì´ ìˆìœ¼ì‹œë©´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.

---

ì—¬ìì¹œêµ¬ê°€ ê¸°ë¶„ì´ ë‚˜ì ë•? 
ì•„ì›ƒë¸Œë ˆì¸~
ê°ì‚¬í•©ë‹ˆë‹¤. 
